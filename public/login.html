<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Masuk â€” Travel Dashboard</title>

  <!-- Font & Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://unpkg.com/lucide@0.260.0/dist/esm/index.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      color: #fff;
      overflow: hidden;
    }
    [data-theme="dark"] body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    .card {
      backdrop-filter: blur(16px);
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      animation: fadeIn .5s ease;
    }
    @keyframes fadeIn {
      from { opacity:0; transform: translateY(15px); }
      to { opacity:1; transform: translateY(0); }
    }
    input {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      padding: 0.6rem 0.8rem;
      width: 100%;
      color: white;
    }
    input::placeholder { color: rgba(255,255,255,0.6); }
    button:hover { transform: translateY(-1px); transition: all .2s; }
    #alert { transition: opacity 0.25s ease; }
  </style>
</head>
<body>

  <main class="card text-center">
    <div class="flex justify-center mb-3">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" stroke="white" fill="none" viewBox="0 0 24 24">
        <path d="M3 3h18v4H3zM6 21h12v-2H6zM6 11h12v8H6z"></path>
      </svg>
    </div>

    <h1 class="text-2xl font-bold mb-1">Travel Dashboard</h1>
    <p class="text-sm text-blue-100 mb-6">Masuk untuk mengelola data tour & sales</p>

    <form id="login-form" class="space-y-3 text-left">
      <div>
        <label class="text-xs text-blue-100">Username</label>
        <input id="username" placeholder="Masukkan username" required>
      </div>
      <div>
        <label class="text-xs text-blue-100">Password</label>
        <input id="password" type="password" placeholder="Masukkan password" required>
      </div>
      <button type="submit" id="btn-login" class="w-full mt-4 bg-white text-indigo-600 font-semibold rounded-lg py-2 hover:bg-slate-100 transition">
        Masuk
      </button>
    </form>

    <div id="alert" class="mt-3 text-sm text-red-300 hidden"></div>

    <div class="mt-6 text-xs text-blue-100 opacity-75 flex justify-center gap-2">
      <button id="btn-test-email" class="underline">Test email</button>
      <span>Â·</span>
      <a href="#" class="underline opacity-70">Lupa password?</a>
    </div>

    <div class="mt-6 text-[10px] text-blue-200 opacity-70">
      Â© 2025 Travel Dashboard â€” PT Nusantara Wisata Digital
    </div>
  </main>

  <script>
    const API_BASE = '';
    const tokenKey = 'travel_token';
    const refreshKey = 'travel_refresh';
    const userKey = 'travel_user';

    // ðŸš€ Jika sudah login valid, langsung redirect ke dashboard
    async function checkExistingSession() {
      const token = localStorage.getItem(tokenKey);
      if (!token) return;
      try {
        const res = await fetch(API_BASE + '/api/auth/verify', {
          method: 'GET',
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        if (res.ok && data.valid) {
          window.location.href = '/index.html';
        } else {
          localStorage.removeItem(tokenKey);
          localStorage.removeItem(refreshKey);
          localStorage.removeItem(userKey);
        }
      } catch {}
    }
    checkExistingSession();

    // ðŸŽ¯ Handler login
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const btn = document.getElementById('btn-login');
      const alertBox = document.getElementById('alert');
      alertBox.classList.add('hidden');

      btn.disabled = true;
      btn.textContent = 'Memproses...';

      try {
        const res = await fetch(API_BASE + '/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();

        if (res.ok && data.token) {
          localStorage.setItem(tokenKey, data.token);
          localStorage.setItem(refreshKey, data.refreshToken);
          localStorage.setItem(userKey, JSON.stringify(data.user));

          btn.textContent = 'Berhasil!';
          btn.classList.add('bg-green-500','text-white');
          setTimeout(() => window.location.href = '/index.html', 800);
        } else {
          alertBox.textContent = data.error || 'Login gagal, periksa kembali.';
          alertBox.classList.remove('hidden');
        }
      } catch (err) {
        alertBox.textContent = 'Terjadi kesalahan koneksi ke server.';
        alertBox.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        setTimeout(() => btn.textContent = 'Masuk', 2000);
      }
    });

    // ðŸ§© Test email tombol
    document.getElementById('btn-test-email').addEventListener('click', () => {
      alert('Gunakan perintah: npm run test-email di server untuk menguji pengiriman email.');
    });
  </script>
</body>
</html>
