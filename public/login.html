<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login — Travel Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://unpkg.com/lucide@0.260.0/dist/esm/index.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    [data-theme="dark"] body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    .card {
      backdrop-filter: blur(16px);
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    }
    input {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      padding: 0.6rem 0.8rem;
      width: 100%;
      color: white;
    }
    input::placeholder { color: rgba(255,255,255,0.6); }
    button:hover { transform: translateY(-1px); transition: all .2s; }
  </style>
</head>
<body>
  <main class="card text-center animate-fade-in">
    <div class="flex justify-center mb-3">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" stroke="white" fill="none" viewBox="0 0 24 24"><path d="M3 3h18v4H3zM6 21h12v-2H6zM6 11h12v8H6z"></path></svg>
    </div>
    <h1 class="text-2xl font-bold mb-1">Travel Dashboard</h1>
    <p class="text-sm text-blue-100 mb-6">Masuk untuk mengelola data tour & sales</p>

    <form id="login-form" class="space-y-3 text-left">
      <div>
        <label class="text-xs text-blue-100">Username</label>
        <input id="username" placeholder="Masukkan username" required>
      </div>
      <div>
        <label class="text-xs text-blue-100">Password</label>
        <input id="password" type="password" placeholder="Masukkan password" required>
      </div>
      <button type="submit" id="btn-login" class="w-full mt-4 bg-white text-indigo-600 font-semibold rounded-lg py-2">Masuk</button>
    </form>

    <div id="alert" class="mt-3 text-sm text-red-300 hidden">Login gagal.</div>

    <div class="mt-6 text-xs text-blue-100 opacity-75">
      <button id="btn-test-email" class="underline">Test email</button> · <a href="#" class="underline">Lupa password?</a>
    </div>
  </main>

  <script>
    const API_BASE = '';
    const tokenKey = 'travel_token';
    const userKey = 'travel_user';

    // jika sudah login, redirect langsung
    const token = localStorage.getItem(tokenKey);
    if (token) {
      window.location.href = '/index.html';
    }

    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const btn = document.getElementById('btn-login');
      btn.disabled = true;
      btn.textContent = 'Memproses...';
      const alert = document.getElementById('alert');
      alert.classList.add('hidden');

      try {
        const res = await fetch(API_BASE + '/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok && data.token) {
          localStorage.setItem(tokenKey, data.token);
          localStorage.setItem(userKey, JSON.stringify(data.user));
          window.location.href = '/index.html';
        } else {
          alert.textContent = data.error || 'Login gagal.';
          alert.classList.remove('hidden');
        }
      } catch (err) {
        alert.textContent = 'Terjadi kesalahan koneksi.';
        alert.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Masuk';
      }
    });

    document.getElementById('btn-test-email').addEventListener('click', () => {
      alert('Gunakan perintah `npm run test-email` di server.');
    });
  </script>
</body>
</html>
