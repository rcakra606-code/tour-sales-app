<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audit Log - Travel Dashboard Enterprise</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-gray-50 flex flex-col">
    <header class="bg-white shadow px-6 py-3 flex justify-between items-center">
      <h1 class="font-bold text-lg text-indigo-700">Audit Log</h1>
      <div class="flex items-center gap-4">
        <span id="userNameDisplay" class="text-sm text-gray-600">Loading...</span>
        <button data-logout class="text-sm text-red-600 font-semibold hover:underline">Logout</button>
      </div>
    </header>

    <main class="flex-1 p-6">
      <div class="bg-white rounded-xl shadow p-6 border border-gray-100 mb-6">
        <div class="flex flex-wrap gap-4 mb-4">
          <input id="filterUser" type="text" placeholder="Cari user..." class="border rounded px-3 py-2 text-sm" />
          <input id="filterAction" type="text" placeholder="Cari aksi..." class="border rounded px-3 py-2 text-sm" />
          <button id="filterBtn" class="bg-indigo-600 text-white text-sm px-4 py-2 rounded hover:bg-indigo-700">Filter</button>
          <button id="clearBtn" class="bg-gray-300 text-gray-800 text-sm px-4 py-2 rounded hover:bg-gray-400">Reset</button>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left border">
            <thead class="bg-gray-100 text-gray-700">
              <tr>
                <th class="py-2 px-2">#</th>
                <th>Username</th>
                <th>Role</th>
                <th>Aksi</th>
                <th>Target</th>
                <th>Waktu</th>
              </tr>
            </thead>
            <tbody id="logTable" class="text-gray-700"></tbody>
          </table>
        </div>
      </div>
    </main>

    <footer class="text-center text-xs text-gray-400 py-3 border-t">
      Â© 2025 Travel Dashboard Enterprise v3.4.1
    </footer>

    <script src="/js/app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const logTable = document.getElementById("logTable");
        const userFilter = document.getElementById("filterUser");
        const actionFilter = document.getElementById("filterAction");
        const filterBtn = document.getElementById("filterBtn");
        const clearBtn = document.getElementById("clearBtn");

        async function loadLogs(filters = {}) {
          const params = new URLSearchParams(filters);
          try {
            const data = await apiFetch(`/api/logs?${params.toString()}`);
            logTable.innerHTML = data.logs
              .map(
                (l, i) => `
                <tr class="border-b hover:bg-gray-50">
                  <td class="py-1 px-2">${i + 1}</td>
                  <td>${l.username}</td>
                  <td>${l.role}</td>
                  <td>${l.action}</td>
                  <td>${l.target}</td>
                  <td>${new Date(l.timestamp).toLocaleString("id-ID")}</td>
                </tr>`
              )
              .join("");
          } catch {
            showToast("Gagal memuat log", { type: "error" });
          }
        }

        filterBtn.addEventListener("click", () => {
          loadLogs({
            username: userFilter.value,
            action: actionFilter.value,
          });
        });

        clearBtn.addEventListener("click", () => {
          userFilter.value = "";
          actionFilter.value = "";
          loadLogs();
        });

        loadLogs();
      });
    </script>
  </body>
</html>
