# ==========================================================
# ğŸš€ Render Deployment Config â€” Travel Dashboard Enterprise v3.4.2
# ==========================================================
# âœ… Auto-init database via scripts/init-db.js
# âœ… PostgreSQL (Neon) connection ready
# âœ… Secure environment with JWT_SECRET
# âœ… Compatible with auto health check
# âœ… Cron job & disk mount included
# ==========================================================

services:
  - type: web
    name: travel-dashboard
    env: node
    region: singapore
    plan: free

    # ============================================
    # ğŸ”§ Build & Start Commands
    # ============================================
    buildCommand: |
      echo "ğŸ“¦ Installing dependencies..."
      npm install
    startCommand: |
      echo "âš™ï¸ Menjalankan inisialisasi database..."
      node scripts/init-db.js || echo "âš ï¸ Init DB gagal, lanjutkan startup..."
      echo "ğŸš€ Menjalankan server..."
      node server.js

    # ============================================
    # ğŸŒ Environment Variables
    # ============================================
    envVars:
      - key: NODE_ENV
        value: production

      - key: PORT
        value: 3000

      # ğŸ”‘ Database Neon PostgreSQL connection
      - key: DATABASE_URL
        value: postgresql://neondb_owner:password@ep-yourdb-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require

      # ğŸ”’ JWT Secret for token encryption
      - key: JWT_SECRET
        generateValue: true

      # ğŸ” Optional: Default admin password
      - key: INIT_ADMIN_PASSWORD
        value: admin123

      # ğŸ•’ Cron-like backup setting (optional)
      - key: CRON_BACKUP_SCHEDULE
        value: "0 3 * * *"

    # ============================================
    # ğŸ’¾ Persistent Storage
    # ============================================
    disk:
      name: data-storage
      mountPath: /opt/render/project/src/data
      sizeGB: 1

    # ============================================
    # â¤ï¸ Health Check
    # ============================================
    healthCheckPath: /api/health

    # ============================================
    # âš™ï¸ Deployment Behavior
    # ============================================
    autoDeploy: true
